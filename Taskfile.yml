# https://taskfile.dev

version: '3'

vars:
  GREETING: "PlemolKR Font Build System"
  VERSION:
    sh: grep "VERSION" build.ini | cut -d "=" -f 2 | tr -d " "

tasks:
  default:
    desc: ë¹Œë“œ ì‹œìŠ¤í…œ ì •ë³´ í‘œì‹œ
    silent: true
    cmds:
      - echo "{{.GREETING}}"
      - echo "ë²„ì „{{"{{"}} .VERSION {{"}}"}}"
      - echo ""
      - task --list-all

  # ============================================
  # ê¸°ë³¸ ë¹Œë“œ íƒœìŠ¤í¬
  # ============================================

  build:
    desc: ê¸°ë³¸ ë¹Œë“œ (1:2 ë¹„ìœ¨)
    cmds:
      - python fontforge_script.py
      - echo "âœ… ê¸°ë³¸ ë¹Œë“œ ì™„ë£Œ"

  build:35:
    desc: 3:5 ë¹„ìœ¨ ë¹Œë“œ
    cmds:
      - python fontforge_script.py --35 --do-not-delete-build-dir
      - echo "âœ… 3:5 ë¹„ìœ¨ ë¹Œë“œ ì™„ë£Œ"

  build:console:
    desc: ì½˜ì†” ëª¨ë“œ ë¹Œë“œ (1:2 ë¹„ìœ¨)
    cmds:
      - python fontforge_script.py --console --do-not-delete-build-dir
      - echo "âœ… ì½˜ì†” ëª¨ë“œ ë¹Œë“œ ì™„ë£Œ"

  build:console35:
    desc: ì½˜ì†” ëª¨ë“œ ë¹Œë“œ (3:5 ë¹„ìœ¨)
    cmds:
      - python fontforge_script.py --console --35 --do-not-delete-build-dir
      - echo "âœ… ì½˜ì†” ëª¨ë“œ (3:5) ë¹Œë“œ ì™„ë£Œ"

  build:nf:
    desc: Nerd Fonts í¬í•¨ ë¹Œë“œ (1:2 ë¹„ìœ¨)
    cmds:
      - python fontforge_script.py --nerd-font --do-not-delete-build-dir
      - echo "âœ… Nerd Fonts ë¹Œë“œ ì™„ë£Œ"

  build:nf35:
    desc: Nerd Fonts í¬í•¨ ë¹Œë“œ (3:5 ë¹„ìœ¨)
    cmds:
      - python fontforge_script.py --nerd-font --35 --do-not-delete-build-dir
      - echo "âœ… Nerd Fonts (3:5) ë¹Œë“œ ì™„ë£Œ"

  build:console-nf:
    desc: ì½˜ì†” ëª¨ë“œ + Nerd Fonts (1:2 ë¹„ìœ¨)
    cmds:
      - python fontforge_script.py --console --nerd-font --do-not-delete-build-dir
      - echo "âœ… ì½˜ì†” + Nerd Fonts ë¹Œë“œ ì™„ë£Œ"

  build:console-nf35:
    desc: ì½˜ì†” ëª¨ë“œ + Nerd Fonts (3:5 ë¹„ìœ¨)
    cmds:
      - python fontforge_script.py --console --nerd-font --35 --do-not-delete-build-dir
      - echo "âœ… ì½˜ì†” + Nerd Fonts (3:5) ë¹Œë“œ ì™„ë£Œ"

  build:hs:
    desc: ì „ê° ìŠ¤í˜ì´ìŠ¤ ìˆ¨ê¹€ ë¹Œë“œ (1:2 ë¹„ìœ¨)
    cmds:
      - python fontforge_script.py --hidden-zenkaku-space --do-not-delete-build-dir
      - echo "âœ… ì „ê° ìŠ¤í˜ì´ìŠ¤ ìˆ¨ê¹€ ë¹Œë“œ ì™„ë£Œ"

  build:hs35:
    desc: ì „ê° ìŠ¤í˜ì´ìŠ¤ ìˆ¨ê¹€ ë¹Œë“œ (3:5 ë¹„ìœ¨)
    cmds:
      - python fontforge_script.py --hidden-zenkaku-space --35 --do-not-delete-build-dir
      - echo "âœ… ì „ê° ìŠ¤í˜ì´ìŠ¤ ìˆ¨ê¹€ (3:5) ë¹Œë“œ ì™„ë£Œ"

  # ============================================
  # í°íŠ¸ ìµœì¢… ì²˜ë¦¬ íƒœìŠ¤í¬
  # ============================================

  polish:
    desc: ë¹Œë“œëœ í°íŠ¸ ìµœì¢… ì²˜ë¦¬ (íŒíŒ… ë° ë³‘í•©)
    cmds:
      - python fonttools_script.py
      - echo "âœ… í°íŠ¸ ìµœì¢… ì²˜ë¦¬ ì™„ë£Œ"

  polish:variant:
    desc: íŠ¹ì • ë³€í˜• í°íŠ¸ë§Œ ì²˜ë¦¬
    cmds:
      - python fonttools_script.py {{.VARIANT}}
      - echo "âœ… {{.VARIANT}} ë³€í˜• ì²˜ë¦¬ ì™„ë£Œ"

  # ============================================
  # ì „ì²´ ë¹Œë“œ ì›Œí¬í”Œë¡œìš°
  # ============================================

  full:
    desc: ì „ì²´ ë¹Œë“œ (1:2 + 3:5 ë¹„ìœ¨)
    cmds:
      - echo "ğŸš€ ì „ì²´ ë¹Œë“œ ì‹œì‘..."
      - task clean
      - task build
      - task build:35
      - task polish
      - echo "âœ… ì „ì²´ ë¹Œë“œ ì™„ë£Œ!"
      - ls -lh build/PlemolKR*.ttf | grep -v fontforge | grep -v fonttools

  full:all:
    desc: ëª¨ë“  ë³€í˜• ë¹Œë“œ (ê¸°ë³¸ + 3:5 + ì½˜ì†”)
    cmds:
      - echo "ğŸš€ ëª¨ë“  ë³€í˜• ë¹Œë“œ ì‹œì‘..."
      - task clean
      - task build
      - task build:35
      - task build:console
      - task build:console35
      - task polish
      - echo "âœ… ëª¨ë“  ë³€í˜• ë¹Œë“œ ì™„ë£Œ!"
      - ls -lh build/PlemolKR*.ttf | grep -v fontforge | grep -v fonttools

  full:nerd:
    desc: Nerd Fonts í¬í•¨ ì „ì²´ ë¹Œë“œ
    cmds:
      - echo "ğŸš€ Nerd Fonts ì „ì²´ ë¹Œë“œ ì‹œì‘..."
      - task clean
      - task build:console-nf
      - task build:console-nf35
      - task polish
      - echo "âœ… Nerd Fonts ì „ì²´ ë¹Œë“œ ì™„ë£Œ!"
      - ls -lh build/PlemolKR*.ttf | grep -v fontforge | grep -v fonttools

  # ============================================
  # ë¹ ë¥¸ ë¹Œë“œ (ë””ë²„ê·¸)
  # ============================================

  quick:
    desc: ë¹ ë¥¸ ë¹Œë“œ (Regular ì›¨ì´íŠ¸ë§Œ)
    cmds:
      - python fontforge_script.py --debug
      - python fonttools_script.py
      - ls -lh build/PlemolKR-Regular.ttf
      - echo "âœ… ë¹ ë¥¸ ë¹Œë“œ ì™„ë£Œ (Regularë§Œ)"

  quick:35:
    desc: ë¹ ë¥¸ ë¹Œë“œ (3:5 ë¹„ìœ¨, Regularë§Œ)
    cmds:
      - python fontforge_script.py --debug --35
      - python fonttools_script.py 35
      - ls -lh build/PlemolKR35-Regular.ttf
      - echo "âœ… ë¹ ë¥¸ ë¹Œë“œ ì™„ë£Œ (3:5, Regularë§Œ)"

  # ============================================
  # ìœ í‹¸ë¦¬í‹° íƒœìŠ¤í¬
  # ============================================

  clean:
    desc: ë¹Œë“œ ë””ë ‰í† ë¦¬ ì •ë¦¬
    cmds:
      - rm -rf build
      - mkdir -p build
      - echo "âœ… ë¹Œë“œ ë””ë ‰í† ë¦¬ ì •ë¦¬ ì™„ë£Œ"

  check:
    desc: ìƒì„±ëœ í°íŠ¸ íŒŒì¼ í™•ì¸
    cmds:
      - echo "ğŸ“Š ìƒì„±ëœ í°íŠ¸ íŒŒì¼ ëª©ë¡:"
      - ls -lh build/PlemolKR*.ttf | grep -v fontforge | grep -v fonttools || echo "í°íŠ¸ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."
      - echo ""
      - echo "ğŸ“ˆ ê¸€ë¦¬í”„ ìˆ˜ í™•ì¸:"
      - python work_scripts/check_glyph_number.py build/PlemolKR-Regular.ttf 2>/dev/null || echo "Regular í°íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."

  verify:
    desc: í•œê¸€/ì¼ë³¸ì–´ ë¬¸ì í™•ì¸
    cmds:
      - |
        python3 -c "
        import fontforge
        font = fontforge.open('build/PlemolKR-Regular.ttf')
        korean = [(0xAC00, 'ê°€'), (0xD7A3, 'í£')]
        japanese = [(0x3042, 'ã‚'), (0x30A2, 'ã‚¢')]
        print('í•œê¸€:', all(c in font for c, _ in korean))
        print('ì¼ë³¸ì–´:', all(c in font for c, _ in japanese))
        font.close()
        "

  install:
    desc: í°íŠ¸ë¥¼ ì‹œìŠ¤í…œì— ì„¤ì¹˜ (macOS)
    cmds:
      - cp build/PlemolKR-*.ttf ~/Library/Fonts/
      - echo "âœ… í°íŠ¸ ì„¤ì¹˜ ì™„ë£Œ (~/Library/Fonts/)"

  # ============================================
  # ë¦´ë¦¬ìŠ¤ ì¤€ë¹„
  # ============================================

  release:
    desc: ë¦´ë¦¬ìŠ¤ íŒŒì¼ ì¤€ë¹„
    vars:
      TIMESTAMP:
        sh: date +%Y%m%d%H%M%S
    cmds:
      - mkdir -p release_files/build_{{.TIMESTAMP}}
      - cp build/PlemolKR*.ttf release_files/build_{{.TIMESTAMP}}/ 2>/dev/null || true
      - echo "âœ… ë¦´ë¦¬ìŠ¤ íŒŒì¼ ì¤€ë¹„ ì™„ë£Œ release_files/build_{{.TIMESTAMP}}/"
      - ls -lh release_files/build_{{.TIMESTAMP}}/

  # ============================================
  # ì •ë³´ í‘œì‹œ
  # ============================================

  info:
    desc: ë¹Œë“œ í™˜ê²½ ì •ë³´ í‘œì‹œ
    cmds:
      - echo "ğŸ“¦ PlemolKR ë¹Œë“œ ì‹œìŠ¤í…œ"
      - echo "ë²„ì „{{"{{"}} .VERSION {{"}}"}}"
      - echo ""
      - echo "ğŸ Python ë²„ì „:"
      - python --version
      - echo ""
      - echo "ğŸ”§ FontForge ë²„ì „:"
      - fontforge --version 2>&1 | head -1 || echo "FontForgeë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
      - echo ""
      - echo "ğŸ“š ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€:"
      - pip3 list | grep -E "fonttools|ttfautohint" || echo "í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”"
